<!DOCTYPE html>
<html data-framework="emberjs">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>ember.js • Burpee</title>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="js/libs/font-awesome/css/font-awesome.min.css">
  <!-- <link rel="stylesheet" href="css/normalize.css"> -->
  <!-- <link rel="stylesheet" href="css/style.css"> -->

  <style type="text/css">

    #nomsTable {
      margin-top: 15px;
    }

    #nomsTable td, th {
      text-align: center;
      vertical-align: middle;
      padding: 5px 20px 5px 20px;
    }

    .foodDiary {
      padding-top: 20px;
      width: 500px;
      margin: 0 auto;
    }

  </style>
</head>
<body>

  <script type="text/x-handlebars" id="application">
    <div class="page-header">
        <h1 align="center">#Sekta</h1>
    </div>
    {{outlet}}
  </script>

  <script type="text/x-handlebars" data-template-name="noms">
    <section id="sektaapp">
      <div align="center" class="container foodDiary">
        <div class="input-group">
          {{input type="text" class="form-control" id="new-nom" placeholder="что ты опять съела?"
            value=newTitle action="createNom"}}
          <span class="input-group-btn"
            <!-- //div class="btn-group" -->
              <a class="btn btn-success" {{action "createNom"}}>
                <i class="icon-plus"></i>
              </a>
              <!--//button type="button" class="btn btn-default" {{action "createChart"}}>create chart</button-->
            <!--//div-->
          </span>
        </div>


        <!-- food diary table -->
        <table class="table table-bordered" id="nomsTable">
          <tr>
            <th>когда</th>
            <th>что</th>
            <th>сколько</th>
            <th>изменить</th>
          </tr>
          <tr>
            <td>9:40</td>
            <td>nom one</td>
            <td>150 g</td>
            <td><a>edit</a> | <a>del</a></td>
          </tr>
          {{#each itemController="nom"}}
            <tr>
              <td>{{timestamp}}</td>
              <td>{{title}}</td>
              <td>{{weight}}</td>
              <td>
                <div class="btn-group" btn-group-sm>
                  <a class="btn btn-default" {{action "editNom"}}>
                    <i class="icon-edit"></i>
                  </a>
                  <a class="btn btn-danger" {{action "removeNom"}}>
                    <i class="icon-trash"></i>
                  </a>
                </div>
              </td>
            </tr>
          {{/each}}
        </table>
      </div>
      <div id="vis" align="center"></div>

    </section>
  </script>


  <script src="js/libs/jquery/jquery.js"></script>
  <script src="js/libs/handlebars/handlebars.js"></script>
  <script src="js/libs/ember/ember.js"></script>
  <script src="js/libs/ember/ember-data.js"></script>
  <script src="js/libs/d3/d3.js"></script>
  <script src="js/libs/bootstrap/bootstrap.js"></script>
  <!-- // <script src="js/app.js"></script> -->

  <script>

    window.Noms = Ember.Application.create({
      LOG_TRANSITIONS: true,
      LOG_BINDINGS: true,
      LOG_VIEW_LOOKUPS: true,
      LOG_STACKTRACE_ON_DEPRECATION: true,
      LOG_VERSION: true,
      debugMode: true
    });


    // Route
    Noms.Router.map(function() {
      this.resource('noms', {path: '/'});
    });

    Noms.NomsRoute = Ember.Route.extend({
      model: function() {
        return this.store.find('nom');
      }
    });


    // Models
    Noms.Nom = DS.Model.extend({
      timestamp: DS.attr('string'),
      title: DS.attr('string'),
      weight: DS.attr('number')
    });

    // Noms.vis = Ember.View.create({
    //   sum: Ember.Binding.oneWay('Noms.nom.weight')
    // });

    Noms.ApplicationAdapter = DS.FixtureAdapter.extend();

    Noms.Nom.FIXTURES = [
      {
        id: 41,
        timestamp: '19:00',
        title: 'Tea',
        weight: 350
      },
      {
        id: 42,
        timestamp: '19:00',
        title: 'Cake',
        weight: 100
      }
    ];


  //   // Views

    // Controllers
    Noms.NomsController = Ember.ArrayController.extend({
      actions: {
        createNom: function() {
          var title = this.get('newTitle');
          this.set('newTitle', '');
          if (!title.trim()) {return;}

          var time = new Date();

          var nom = this.store.createRecord('nom', {
            timestamp: time.getHours().toString() + ':' +
                       time.getMinutes().toString(),
            title: title,
            weight: 100
          });

          nom.save();
        },
        createChart: function() {
          console.log(Noms.Nom.FIXTURES);
          // data = Noms.Nom.FIXTURES.getEach('weight');
          // console.log(data);

          var data = d3.nest()
            .key(function(d) {return d.weight;})
            .entries(Noms.Nom.FIXTURES.getEach('weight'));

          console.log(data);

          var width = 500,
            height = 250;

          var x = d3.scale.linear()
            .domain([0, data.length - 1])
            .range([0, width]);

          var y = d3.scale.linear()
            .domain([d3.min(data), d3.max(data)])
            .range([height, 0]);

          var line = d3.svg.line()
            .interpolate("basic")
            .x(function(d, i) {return x(i);})
            .y(function(d, i) {return y(d);});

          var svg = d3.select("#vis")
            .append("svg:svg")
            .attr('width', width)
            .attr('height', height)
            // .append('svg:g')
            .attr('id', 'chart')
            .attr("transform", "translate(" + width / 2 + "," + (height / 2) + ")");

          var series = svg.selectAll('g.series')
            .data(d3.keys(data))
            .enter()
            .append('g')
            .attr('class', 'series');

          // var weightLine = svg.selectAll(".weight")
          //   .data(data)
          // .enter().append("g")
          //   .append("path")
          //   .attr("d", function(d) {return line(d);})
          //   .style("stroke", "black");

          var weightLine = series.selectAll('.line')
            .data(d3.keys(data))
            .enter()
            .append('svg:path')
            .attr('d', function(d) {
              return line(data[d]);
            })
            .attr('class', 'line');





          // console.log(data);


        }
      }
    });

    Noms.NomController = Ember.ObjectController.extend({
      actions: {
        removeNom: function() {
          var nom = this.get('model');

          nom.deleteRecord();
          nom.save();
        }
      }
    });

  </script>
  <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>

</body>
</html>
